syntax = "proto3";

package influenzanet.user_management_api;
option go_package = "github.com/Influenzanet/api/user-management";

import "global-types.proto";
import "google/protobuf/empty.proto";

message Profile {
    string first_name = 1;
    string last_name = 2;
}

message NewUser {
    string email = 1;
    string password = 2;
    Profile profile = 3;
}

message UserAuthInfo {
    string user_id = 1;
    repeated string roles = 2;
    string authenticated_role = 3;
}

message UserReference {
    influenzanet.ParsedToken auth = 1;
    string user_id = 2;
}

message PasswordChangeMsg {
    influenzanet.ParsedToken auth = 1;
    string user_id = 2;
    string old_password = 3;
    string new_password = 4;
}

service UserManagementApi {
    rpc Status(google.protobuf.Empty) returns (influenzanet.Status);

    // Auth and Token handling:
    rpc LoginWithEmail(influenzanet.UserCredentials) returns (UserAuthInfo);
    rpc SignupWithEmail(NewUser) returns (UserAuthInfo);

    rpc ChangePassword(PasswordChangeMsg) returns (influenzanet.Status);
}